---

# This playbook runs the setup process for Arvados on a total of eight hosts.

- name: Add Arvados repos
  hosts: arvados_hosts
  become: true

  roles:
    - repos

- name: Add Arvados config
  hosts: arvados_hosts
  become: true

  roles:
    - config

- name: Install Postgres
  hosts: arvados-postgres
  become: true

  roles:
    - postgres
    
- name: Setup API / controller
  hosts: arvados-api
  become: true

  roles:
    - arvados-api

- name: Setup Keepstore 0
  hosts: arvados-keep0
  become: true

  roles:
    - arvados-keep0

- name: Restart API / controller software
  hosts: arvados-api
  become: true

  tasks:
  - name: Restart nginx
    systemd:
      name: nginx
      state: restarted

  - name: Restart arvados-controller
    system:
      name: arvados-controller
      state: restarted


    